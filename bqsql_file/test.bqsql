# 1
SELECT
  name,
  SUBSTR(name, 1, STRPOS(name, ' ') - 1) AS family_name,
  SUBSTR(name, 1, STRPOS(name, ' ') + 1) AS first_name
FROM
  sample.customers
LIMIT
  5;

# 1
WITH
  master AS (
    SELECT
      FORMAT_DATETIME('%m', date_time) AS MONTH,
      FORMAT_DATETIME('%y', date_time) AS YEAR,
      SUM(revenue) AS sum_rev
    FROM
      sample.sales
    GROUP BY
      MONTH,
      YEAR
  )
SELECT
  YEAR,
  MAX(max_rev) - MIN(min_rev) AS hani
FROM
  (
    SELECT
      YEAR,
      PERCENTILE_CONT(sum_rev, 0) OVER (
        PARTITION BY
          YEAR
      ) AS min_rev,
      PERCENTILE_CONT(sum_rev, 1) OVER (
        PARTITION BY
          YEAR
      ) AS max_rev
    FROM
      master
  )
GROUP BY
  YEAR
ORDER BY
  YEAR;

WITH
  master AS (
    SELECT
      *,
      revenue / quantity AS non_proper_unit_price,
      (
        SELECT
          SUM(revenue) / SUM(quantity)
        FROM
          sample.sales
        WHERE
          product_id = 1
          AND is_proper IS TRUE
      ) AS proper_unit_price
    FROM
      sample.sales
    WHERE
      product_id = 1
      AND is_proper IS FALSE
  )
SELECT
  SUM(lost_revenue) AS sum_lost_revenue
FROM
  (
    SELECT
      *,
      quantity * (proper_unit_price - non_proper_unit_price) AS lost_revenue
    FROM
      master
  )
SELECT
  8000 / 25600 AS a
  -- test